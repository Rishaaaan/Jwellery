<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Gift Haven</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: #f8fafc;
            color: #334155;
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 600;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .logo span {
            color: #0ea5e9;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: #0ea5e9;
        }

        .cart-count {
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            margin-left: 0.25rem;
        }

        .product-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
        }

        .product-gallery {
            position: sticky;
            top: 100px;
        }

        .product-images {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .thumbnail-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .thumbnail.active {
            border-color: #0ea5e9;
        }

        .main-image-container {
            position: relative;
            width: 100%;
            padding-top: 100%;
            border-radius: 1rem;
            overflow: hidden;
        }

        .main-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .main-image:hover {
            transform: scale(1.05);
        }

        .product-details {
            padding: 2rem;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .product-title {
            font-size: 2rem;
            color: #0f172a;
            margin-bottom: 1rem;
        }

        .product-description {
            color: #64748b;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .product-price {
            font-size: 1.5rem;
            color: #0ea5e9;
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quantity-label {
            font-weight: 500;
            color: #0f172a;
        }

        .quantity-input {
            width: 60px;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            text-align: center;
        }

        .add-to-cart {
            width: 100%;
            padding: 1rem;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .add-to-cart:hover {
            background: #0284c7;
        }

        .related-products {
            max-width: 1200px;
            margin: 4rem auto;
            padding: 0 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 1.5rem;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .related-card {
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .related-card:hover {
            transform: translateY(-2px);
        }

        .related-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }

        .related-info {
            padding: 1rem;
        }

        .related-title {
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 0.5rem;
        }

        .related-price {
            color: #64748b;
        }

        .chat-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #0ea5e9;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            animation: pulse 2s infinite;
        }

        .chat-button .icon-default,
        .chat-button .icon-open {
            position: absolute;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chat-button .icon-default {
            opacity: 1;
            transform: rotate(0deg);
        }

        .chat-button .icon-open {
            opacity: 0;
            transform: rotate(-180deg);
        }

        .chat-button.open {
            animation: none;
            background: #dc2626;
        }

        .chat-button.open .icon-default {
            opacity: 0;
            transform: rotate(180deg);
        }

        .chat-button.open .icon-open {
            opacity: 1;
            transform: rotate(0deg);
        }

        .chat-button:hover {
            transform: scale(1.05);
            background: #0284c7;
        }

        .chat-button.open:hover {
            background: #b91c1c;
        }

        .reset-button {
            position: fixed;
            bottom: 2rem;
            right: calc(2rem + 70px);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ef4444;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            opacity: 0;
            transform: translateX(50px);
            pointer-events: none;
        }

        .reset-button.visible {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
        }

        .reset-button:hover {
            background: #dc2626;
            transform: scale(1.05) translateX(0);
        }

        .reset-button .material-icons {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .reset-button:hover .material-icons {
            transform: rotate(180deg);
        }

        .chat-interface {
            position: fixed;
            bottom: 6rem;
            right: 2rem;
            width: 400px;
            height: 600px;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 999;
            overflow: hidden;
        }

        #chat-interface {
            position: fixed;
            bottom: 90px;
            right: -800px;
            width: 600px;
            height: calc(100% - 125px);
            background: transparent;
            transition: right 0.3s ease;
            z-index: 1001;
            border-radius: 25px;
            margin-right: 24px;
            margin-bottom: 16px;
        }

        #chat-interface.open {
            right: 0;
        }

        @media (max-width: 768px) {

            #chat-interface {
                width: 100%;
                right: -100%;
                margin: 0;
                height: calc(100% - 80px);
                border-radius: 0;
            }

            .product-container {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .product-gallery {
                position: static;
            }

            .related-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        .size-selector,
        .color-selector {
            margin-bottom: 1.5rem;
        }

        .size-label,
        .color-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .size-options,
        .color-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .size-option,
        .color-option {
            padding: 0.5rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.25rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .size-option:hover,
        .color-option:hover {
            border-color: #0ea5e9;
        }

        .size-option.selected,
        .color-option.selected {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
        }

        .try-on-btn {
            width: 100%;
            padding: 1rem;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: background-color 0.3s ease;
        }

        .try-on-btn:hover {
            background: #7c3aed;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            justify-content: center;
            /* Add this */
            align-items: center;
            /* Add this */
        }

        .modal-backdrop.active {
            display: flex;
            opacity: 1;
        }

        .try-on-modal {
            background: white;
            width: 90%;
            max-width: 800px;
            margin: auto;
            border-radius: 1rem;
            padding: 2rem;
            position: relative;
            transform: translateY(-50px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal-backdrop.active .try-on-modal {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #64748b;
            padding: 0.5rem;
        }

        .upload-section {
            text-align: center;
            padding: 3rem;
            border: 2px dashed #e2e8f0;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }

        .upload-section.dragover {
            border-color: #0ea5e9;
            background: #f0f9ff;
        }

        .upload-text {
            color: #64748b;
            margin-bottom: 1rem;
        }

        .upload-btn {
            padding: 0.75rem 1.5rem;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .upload-btn:hover {
            background: #0284c7;
        }

        .similar-products {
            position: relative;
            padding: 1rem 0;
            margin: 2rem 0;
        }

        .products-scroll {
            display: flex;
            gap: 1.5rem;
            overflow: hidden;
            scroll-behavior: smooth;
            padding: 2rem 0;
            margin: 0 auto;
            max-width: 500px;
            align-items: center;
        }

        .product-thumb {
            flex: 0 0 120px;
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
            transform: scale(0.85);
        }

        .product-thumb.active {
            flex: 0 0 160px;
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .product-thumb img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            transition: height 0.3s ease;
        }

        .product-thumb.active img {
            height: 160px;
        }

        .scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .scroll-btn.left {
            left: -20px;
        }

        .scroll-btn.right {
            right: -20px;
        }

        .scroll-btn:hover {
            background: #f8fafc;
        }

        .preview-section {
            display: flex;
            gap: 1.5rem;
            flex: 1;
            height: 500px;
            /* Add fixed height */
            margin-bottom: 1rem;
        }

        .preview-main-container {
            flex: 1;
            position: relative;
            border-radius: 1rem;
            background: #f8fafc;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            /* Ensure full height */
        }

        .preview-thumbnails {
            flex: 0 0 60px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            height: 100%;
            /* Ensure full height */
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .preview-main-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .preview-main-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .tryout-left {
            flex: 0 0 60%;
            padding: 2rem;
            border-right: 1px solid #e2e8f0;
            display: flex !important;
            flex-direction: column !important;
            gap: 1rem;
            height: 100%;
            overflow-y: auto;
            /* Add scroll for overflow content */
        }

        .preview-section.active {
            display: block;
        }

        .preview-canvas {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 0.5rem;
            background: #f8fafc;
            margin-bottom: 2rem;
            position: relative;
            filter: drop-shadow(5px 5px 5px rgba(255, 0, 0, 0.3)) drop-shadow(-5px -5px 5px rgba(0, 255, 0, 0.3)) drop-shadow(5px -5px 5px rgba(0, 0, 255, 0.3));
        }

        .rgb-shadow {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: -1;
        }

        .shadow-red,
        .shadow-green,
        .shadow-blue {
            position: absolute;
            width: 100%;
            height: 100%;
            mix-blend-mode: screen;
            filter: blur(10px);
            opacity: 0;
            transition: all 0.5s ease;
        }

        .shadow-red {
            background: radial-gradient(circle at 30% 70%, rgba(255, 0, 0, 0.4), transparent 70%);
            animation: shadowShift 4s ease infinite;
        }

        .shadow-green {
            background: radial-gradient(circle at 70% 30%, rgba(0, 255, 0, 0.4), transparent 70%);
            animation: shadowShift 4s ease infinite 1s;
        }

        .shadow-blue {
            background: radial-gradient(circle at 50% 50%, rgba(0, 0, 255, 0.4), transparent 70%);
            animation: shadowShift 4s ease infinite 2s;
        }

        @keyframes shadowShift {

            0%,
            100% {
                transform: translate(0, 0);
                opacity: 0.6;
            }

            50% {
                transform: translate(5px, 5px);
                opacity: 0.3;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
            50% { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); }
            100% { transform: scale(1); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
        }

        .processing-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.8);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 10;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* New styles for the modified try-on experience */
        .tryout-init {
            background: white;
            width: 90%;
            /* Change from 400px to relative */
            max-width: 400px;
            /* Add max-width */
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            position: relative;
            transform: translateY(-20px);
            /* Add initial offset for animation */
            transition: transform 0.3s ease;
        }

        .preview-thumbnails {
            flex: 0 0 60px;
            /* Reduced from 120px */
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            /* Reduced from 1rem */
            height: 100%;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .preview-thumb::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.5rem;
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        .preview-thumb.active {
            border-color: #0ea5e9;
            transform: translateX(4px);
        }

        .preview-main-container {
            flex: 1;
            position: relative;
            border-radius: 1rem;
            background: #f8fafc;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-main-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            /* Changed from zoom-in */
        }

        .preview-main-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
        }

        .preview-controls {
            display: none;
        }

        .tryout-right {
            flex: 0 0 40%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            /* Change from auto to hidden */
        }

        .main-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-thumb.active {
            border-color: #0ea5e9;
        }

        .preview-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .similar-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            margin-right: -1rem;
            /* Compensate for padding */
            margin-left: -1rem;
            /* Improved scrollbar styling */
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 transparent;
        }

        .similar-list::-webkit-scrollbar {
            width: 6px;
        }

        .similar-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .similar-list::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }

        .similar-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
            transition: all 0.2s;
            margin-bottom: 1rem;
            background: white;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .similar-item:hover {
            transform: translateX(5px);
            background: #f1f5f9;
        }

        .similar-item:last-child {
            margin-bottom: 0;
        }

        .similar-image {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            overflow: hidden;
            flex-shrink: 0;
        }

        .similar-details h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #0f172a;
        }

        .similar-details p {
            color: #0ea5e9;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .similar-colors {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 0 1px #e2e8f0;
            transition: all 0.2s;
        }

        .color-dot:hover {
            transform: scale(1.2);
        }

        .upload-container {
            text-align: center;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .upload-icon {
            font-size: 2.5rem;
            color: #0ea5e9;
        }

        .upload-text {
            color: #64748b;
            font-size: 0.95rem;
        }

        .upload-btn {
            padding: 0.75rem 1.5rem;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
        }

        .begin-btn {
            padding: 0.75rem 1.5rem;
            background: #0ea5e9;
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
        }

        .begin-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .begin-btn:not(:disabled):hover,
        .upload-btn:hover {
            background: #0284c7;
            transform: translateY(-1px);
        }

        .upload-preview {
            margin: 0.75rem auto;
            width: 150px;
            height: 150px;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            order: 2;
        }

        .modal-backdrop.active {
            opacity: 1;
            pointer-events: auto;
        }

        .tryout-init {
            transform: scale(0.95) translateY(20px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-backdrop.active .tryout-init {
            transform: scale(1) translateY(0);
            opacity: 1;
        }

        @keyframes slideIn {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .tryout-main {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            opacity: 0;
            visibility: hidden;
            width: 90%;
            max-width: 1200px;
            height: 90vh;
            background: white;
            border-radius: 1rem;
            display: flex;
            z-index: 2001;
        }

        .tryout-main.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }


        .tryout-main .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 10;
            transition: all 0.2s ease;
        }

        .tryout-main .modal-close:hover {
            background: #f1f5f9;
            color: #ef4444;
            transform: scale(1.1);
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loader-container {
            position: relative;
            border-radius: 50%;
            height: 96px;
            width: 96px;
            animation: rotate_3922 1.2s linear infinite;
            background-color: #9b59b6;
            background-image: linear-gradient(#9b59b6, #84cdfa, #5ad1cd);
        }

        .loader-container span {
            position: absolute;
            border-radius: 50%;
            height: 100%;
            width: 100%;
            background-color: #9b59b6;
            background-image: linear-gradient(#9b59b6, #84cdfa, #5ad1cd);
        }

        .loader-container span:nth-of-type(1) {
            filter: blur(5px);
        }

        .loader-container span:nth-of-type(2) {
            filter: blur(10px);
        }

        .loader-container span:nth-of-type(3) {
            filter: blur(25px);
        }

        .loader-container span:nth-of-type(4) {
            filter: blur(50px);
        }

        .loader-container::after {
            content: "";
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background-color: #fff;
            border: solid 5px #ffffff;
            border-radius: 50%;
        }

        @keyframes rotate_3922 {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .tryout-left .main-preview {
            flex: 1;
            width: 100%;
            min-height: 0;
            /* Add this to allow flex shrinking */
            position: relative;
            margin-bottom: 0.5rem;
            /* Reduced from 1rem */
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            padding: 1rem;
            height: calc(95% - 80px);
            /* Reduced from 100% to 95% */
        }


        .tryout-left .main-preview img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            position: relative;
            /* Change from absolute */
            object-fit: contain;
        }


        .tryout-left .preview-grid {
            display: flex;
            /* Change from grid to flex */
            justify-content: center;
            gap: 1rem;
            margin-top: auto;
            height: 70px;
            padding: 0.5rem 1rem;
            overflow-x: auto;
            /* Allow horizontal scroll if needed */
        }

        .preview-thumb {
            flex: 0 0 50px;
            width: 50px;
            height: 50px;
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            background: white;
            position: relative;
            overflow: hidden;
            aspect-ratio: 1;
            cursor: pointer;
            transition: all 0.2s;
        }


        .color-options-bar {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 0;
            justify-content: center;
        }

        .color-option-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .color-option-btn:hover {
            transform: scale(1.1);
        }

        .color-option-btn.active {
            border-color: #0ea5e9;
        }

        .color-option-btn.active::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
        }

        .preview-grid::-webkit-scrollbar {
            width: 4px;
            display: none;
        }

        .preview-grid::-webkit-scrollbar-track {
            background: transparent;
        }

        .preview-grid::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .tryout-left {
            flex: 0 0 60%;
            padding: 2rem;
            border-right: 1px solid #e2e8f0;
            display: flex !important;
            flex-direction: column !important;
            gap: 1rem;
            height: 100%;
        }

        .preview-grid {
            flex: 0 0 120px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: calc(100vh - 200px);
            /* Fixed height calculation */
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .preview-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            height: 100%;
        }

        .main-preview {
            flex: 1;
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tryout-right {
            flex: 0 0 40%;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .tryout-right-top {
            flex: 0 0 auto;
            /* Change from fixed height to auto */
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .product-name {
            font-size: 1.25rem;
            /* Reduced from 1.5rem */
            margin-bottom: 0.75rem;
            /* Reduced margin */
        }

        .review-grid {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 0.75rem;
            /* Reduced margin */
        }

        .star-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #fbbf24;
        }

        .purchase-count {
            color: #64748b;
            font-size: 0.875rem;
        }

        .price-grid {
            background: #f8fafc;
            padding: 0.75rem;
            /* Reduced padding */
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            /* Reduced margin */
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .limited-deal {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
        }

        .deal-label {
            display: inline-block;
            background: #dc2626;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .countdown {
            font-size: 0.875rem;
            color: #dc2626;
            font-weight: 500;
        }

        .price-display {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
        }

        .discount-row {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }

        .discount-percent {
            color: #dc2626;
            font-weight: 600;
            font-size: 1.125rem;
        }

        .current-price {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a202c;
        }

        .original-price {
            color: #64748b;
            text-decoration: line-through;
            font-size: 0.875rem;
        }

        .buy-now-btn {
            width: 100%;
            margin-top: -12px;
            padding: 1rem;
            background: #059669;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .buy-now-btn:hover {
            background: #047857;
        }

        .tryout-right-bottom {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .similar-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #0f172a;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .similar-header .product-count {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: normal;
        }

        .similar-list {
            flex: 1;
            overflow-y: auto;
            padding: 1rem 1.5rem;
        }

        .size-grid {
            margin-bottom: 1rem;
        }

        .size-grid-label {
            margin-top: -8px;
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .size-grid-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            /* Changed from 4 to 5 columns */
            gap: 0.375rem;
            /* Reduced gap */
        }

        .size-grid-option {
            padding: 0.5rem 0.25rem;
            /* Reduced padding */
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            /* Slightly smaller radius */
            background: white;
            color: #1a202c;
            font-size: 0.875rem;
            /* Smaller font */
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .size-grid-option:hover {
            border-color: #0ea5e9;
        }

        .size-grid-option.active {
            background: #0ea5e9;
            color: white;
            border-color: #0ea5e9;
        }

        .color-options-grid {
            display: none;
            gap: 0.5rem;
            padding: 1rem;
            justify-content: center;
            background: white;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }

        .color-option-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .color-option-btn:hover {
            transform: scale(1.1);
            border-color: #0ea5e9;
        }

        .color-option-btn.active {
            border-color: #0ea5e9;
            transform: scale(1.1);
        }

        .color-option-btn.active::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
        }

        .tryout-left {
            flex: 0 0 60%;
            padding: 2rem;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column !important;
            gap: 1rem;
            height: 100%;
        }

        .preview-section {
            display: flex;
            gap: 1.5rem;
            flex: 1;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <a href="store.html" class="logo">
                <span>üíç</span> Jewellery Haven
            </a>
            <nav class="nav-links">
                <a href="store.html" class="nav-link">Home</a>
                <a href="cart.html" class="nav-link">Cart <span class="cart-count">0</span></a>
                <a href="#" class="nav-link">Categories</a>
                <a href="#" class="nav-link">About</a>
            </nav>
        </div>
    </header>

    <button id="resetButton" class="reset-button" title="Reset Chat">
        <span class="material-icons">restart_alt</span>
    </button>

    <button id="chatButton" class="chat-button" title="Open Jewellery Assistant">
        <span class="material-icons icon-default">chat</span>
        <span class="material-icons icon-open">arrow_forward_ios</span>
    </button>

    <div id="chat-interface">
        <iframe src="checkout-chat.html" style="width: 100%; height: 100%; border: none;"></iframe>
    </div>

    <div class="product-container">
        <div class="product-gallery">
            <div class="product-images">
                <div class="thumbnail-list">
                    <!-- Thumbnails will be added dynamically -->
                </div>
                <div class="main-image-container">
                    <img src="" alt="" class="main-image" id="mainImage">
                </div>
            </div>
        </div>

        <div class="product-details">
            <h1 class="product-title" id="title"></h1>
            <p class="product-description" id="description"></p>
            <div class="product-price" id="price"></div>
            <div class="size-selector">
                <label class="size-label">Size:</label>
                <div class="size-options">
                    <!-- Size options will be added dynamically -->
                </div>
            </div>
            <div class="color-selector">
                <label class="color-label">Color:</label>
                <div class="color-options">
                    <!-- Color options will be added dynamically -->
                </div>
            </div>
            <div class="quantity-selector">
                <label class="quantity-label">Quantity:</label>
                <input type="number" class="quantity-input" value="1" min="1" max="10">
            </div>
            <button class="try-on-btn" onclick="tryOnJewellerys()">
                Try On Virtually
            </button>
            <button class="add-to-cart" onclick="addToCart()">
                Add to Cart
            </button>
        </div>
    </div>

    <div class="related-products">
        <h2 class="section-title">You May Also Like</h2>
        <div class="related-grid" id="relatedProducts">
            <div class="similar-list">
                <!-- <div class="similar-item">
                    <div class="similar-image">
                        <img src="https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=500" alt="Diamond Necklace" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="similar-details">
                        <h4>Royal Diamond Necklace</h4>
                        <p>‚Çπ24,999.99</p>
                    </div>
                </div> -->
                <div class="similar-item">
                    <div class="similar-image">
                        <img src="https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcSRFefqAsJ4SQpUfUJ-FrsPxE3lphhrz_xKzCghvycU5LIPtlHHpULLeBrNxDdQZ3ka2kIFuYabecaaMfdaR_grcc6mnH1EAGr7rLk-zgSU" alt="Pearl Earrings" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="similar-details">
                        <h4>Elegant Pearl Earrings</h4>
                        <p>‚Çπ7,499.99</p>
                    </div>
                </div>
                <div class="similar-item">
                    <div class="similar-image">
                        <img src="https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=500" alt="Gold Bracelet" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="similar-details">
                        <h4>Classic Gold Bracelet</h4>
                        <p>‚Çπ12,999.99</p>
                    </div>
                </div>
                <div class="similar-item">
                    <div class="similar-image">
                        <img src="https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=500" alt="Sapphire Ring" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="similar-details">
                        <h4>Sapphire Engagement Ring</h4>
                        <p>‚Çπ18,499.99</p>
                    </div>
                </div>
                <div class="similar-item">
                    <div class="similar-image">
                        <img src="https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcRJAPtPpBY7cUS4Oa9T1v4qI1AI5vwYLfPkLtWdHuPOyDxlGTDCSWAH67qDS_7RhDYCAbs9p4gMsKme34w3desV08FleNQUznVXAIEvZ5sIsXPPAevRNwbP" alt="Ruby Necklace" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="similar-details">
                        <h4>Ruby Teardrop Necklace</h4>
                        <p>‚Çπ15,999.99</p>
                    </div>
                </div>
            </div>
            <!-- Related products will be added dynamically -->
        </div>
    </div>

    <div class="modal-backdrop" id="tryOnModal">
        <div class="tryout-init" id="tryoutInit">
            <button class="modal-close" onclick="closeTryOnModal()">
                <span class="material-icons">close</span>
            </button>
            <div class="upload-container">
                <div class="upload-icon">
                    <span class="material-icons">cloud_upload</span>
                </div>
                <h3>Virtual Try-On</h3>
                <p class="upload-text">Upload your photo to try on these jewellery virtually</p>
                <input type="file" id="photoUpload" accept="image/*" style="display: none">
                <button class="upload-btn" onclick="document.getElementById('photoUpload').click()">
                    Upload Photo
                </button>
                <button class="begin-btn" id="beginBtn" disabled onclick="startTryout()">
                    Begin Try-On
                </button>
            </div>
        </div>

        <div class="tryout-main" id="tryoutMain">
            <button class="modal-close" onclick="closeTryOnModal()">
                <span class="material-icons">close</span>
            </button>
            <div class="tryout-left">
                <div class="preview-section">
                    <div class="preview-thumbnails">
                        <!-- Thumbnails will be added dynamically -->
                    </div>
                    <div class="preview-main-container">
                        <div class="preview-main-wrapper">
                            <img src="" alt="Preview" class="preview-main-image" id="mainPreview">
                        </div>
                        <div class="loading-overlay" id="loadingOverlay">
                            <div class="loader-container">
                                <span></span>
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="color-options-grid">
                    <!-- Color options will be added dynamically -->
                </div>
            </div>
            <div class="tryout-right">
                <div class="tryout-right-top">
                    <h2 class="product-name">Royal Diamond Necklace</h2>
                    <div class="review-grid">
                        <div class="star-rating">
                            <span class="material-icons">star</span>
                            <span class="material-icons">star</span>
                            <span class="material-icons">star</span>
                            <span class="material-icons">star</span>
                            <span class="material-icons">star_half</span>
                            <span>(4.5)</span>
                        </div>
                        <div class="purchase-count">100+ bought last month</div>
                    </div>
                    <div class="price-grid">
                        <div class="limited-deal">
                            <span class="deal-label">Limited Time Deal</span>
                            <span class="countdown" id="countdown-timer">Ends in 10:00</span>
                        </div>
                        <div class="price-display">
                            <div class="discount-row">
                                <span class="discount-percent">-30%</< /span>
                                    <span class="current-price">‚Çπ17499.99</span>
                            </div>
                            <span class="original-price">‚Çπ24999.99</span>
                        </div>
                    </div>
                    <div class="size-grid">
                        <!-- <div class="size-grid-label">Size (UK)</div> -->
                        <!-- <div class="size-grid-options">
                            <button class="size-grid-option" onclick="selectSize(this, 6)">6</button>
                            <button class="size-grid-option" onclick="selectSize(this, 7)">7</button>
                            <button class="size-grid-option" onclick="selectSize(this, 8)">8</button>
                            <button class="size-grid-option" onclick="selectSize(this, 9)">9</button>
                        </div> -->
                    </div>
                    <button class="buy-now-btn">
                        <!-- <span class="material-icons">flash_on</span> -->
                        Buy Now
                    </button>
                </div>
                <div class="tryout-right-bottom">
                    <div class="similar-header">
                        Similar Products
                    </div>
                    <div class="similar-list">
                        <div class="similar-item">
                            <div class="similar-image">
                                <img src="https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=500" alt="Diamond Necklace" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div class="similar-details">
                                <h4>Royal Diamond Necklace</h4>
                                <p>‚Çπ24,999.99</p>
                            </div>
                        </div>
                        <div class="similar-item">
                            <div class="similar-image">
                                <img src="https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcSRFefqAsJ4SQpUfUJ-FrsPxE3lphhrz_xKzCghvycU5LIPtlHHpULLeBrNxDdQZ3ka2kIFuYabecaaMfdaR_grcc6mnH1EAGr7rLk-zgSU" alt="Pearl Earrings" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div class="similar-details">
                                <h4>Elegant Pearl Earrings</h4>
                                <p>‚Çπ7,499.99</p>
                            </div>
                        </div>
                        <div class="similar-item">
                            <div class="similar-image">
                                <img src="https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=500" alt="Gold Bracelet" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div class="similar-details">
                                <h4>Classic Gold Bracelet</h4>
                                <p>‚Çπ12,999.99</p>
                            </div>
                        </div>
                        <div class="similar-item">
                            <div class="similar-image">
                                <img src="https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=500" alt="Sapphire Ring" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div class="similar-details">
                                <h4>Sapphire Engagement Ring</h4>
                                <p>‚Çπ18,499.99</p>
                            </div>
                        </div>
                        <div class="similar-item">
                            <div class="similar-image">
                                <img src="https://encrypted-tbn3.gstatic.com/shopping?q=tbn:ANd9GcRJAPtPpBY7cUS4Oa9T1v4qI1AI5vwYLfPkLtWdHuPOyDxlGTDCSWAH67qDS_7RhDYCAbs9p4gMsKme34w3desV08FleNQUznVXAIEvZ5sIsXPPAevRNwbP" alt="Ruby Necklace" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div class="similar-details">
                                <h4>Ruby Teardrop Necklace</h4>
                                <p>‚Çπ15,999.99</p>
                            </div>
                        </div>
                    </div>
                </div>                
            </div>
        </div>
    </div>

    <script>
        // Get product ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const tryOnParam = urlParams.get('tryOn');

        // Product data for jewellery
        const products = {
            'indian-royal': {
                title: 'Royal Heritage Juti',
                description: 'Exquisite handcrafted Indian royal footwear featuring traditional embroidery, genuine leather construction, and cushioned insoles for royal comfort. Perfect blend of heritage craftsmanship and modern comfort.',
                price: 4499.99,
                images: [
                    'images/jutti2.webp',
                    'images/jutti1.webp',
                    'images/jutti3.webp',
                    'images/jutti4.webp',
                ],
                sizes: ['6', '7', '8', '9', '10', '11'],
                colors: ['Royal Gold', 'Maroon/Gold', 'Navy/Gold']
            },
            'running-pro': {
                title: 'Urban Blaze: Reverb Neon Black',
                description: 'Premium running jewellery with advanced cushioning technology, breathable mesh upper, and superior arch support for maximum comfort during your workouts.',
                price: 7499.99,
                images: [
                    'images/1.webp',
                    'images/2.webp',
                    'images/3.webp',
                    'images/4.webp',
                    'images/5.webp'
                ],
                sizes: ['7', '8', '9', '10', '11', '12'],
                colors: ['Black/Red', 'Blue/White', 'Grey/Neon']
            },
            'casual-sneaker': {
                title: 'Urban Street Sneaker',
                description: 'Comfortable everyday casual necklaces with memory foam insoles, flexible outsoles, and trendy design elements that complement any casual outfit.',
                price: 4999.99,
                images: [
                    'https://images.unsplash.com/photo-1551107696-a4b0c5a0d9a2?w=500',
                    'https://images.unsplash.com/photo-1600185365926-3a2ce3cdb9eb?w=500',
                    'https://images.unsplash.com/photo-1595950653106-6c9ebd614d3a?w=500'
                ],
                sizes: ['7', '8', '9', '10', '11'],
                colors: ['Brown', 'Black', 'Navy']
            },
            'sport-elite': {
                title: 'Elite Sport Max',
                description: 'Professional athletic performance jewellery engineered for maximum performance and durability with responsive cushioning.',
                price: 8999.99,
                images: [
                    'https://images.unsplash.com/photo-1565814636199-ae8133055c1c?w=500',
                    'https://images.unsplash.com/photo-1605408499391-6368c628ef42?w=500',
                    'https://images.unsplash.com/photo-1609250291996-fdebe6020a8f?w=500'
                ],
                sizes: ['8', '9', '10', '11', '12'],
                colors: ['Black/Yellow', 'Blue/Orange', 'White/Red']
            },
            'pearl-earrings': {
                title: 'Elegant Pearl Earrings',
                description: 'Premium cultured pearl earrings with sterling silver settings',
                price: 7499.99,
                images: [
                    'https://encrypted-tbn0.gstatic.com/shopping?q=tbn:ANd9GcQ6_WJcQOBpFSpc2sGIElbOhYfOTcry9HT_bglfwbayDH3G7uJ8mCdL7z6vs_eZtCy_WdfeX7yG-iBwklHav7HMZwThZltITw',
                    'https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcT08x-JoeCnaCocXSIJOFb5CklTUejLJlfZ-RfcXknDZ9LFtPiBT8SswvQYvLwKriBxqzoZgBs4zTFDdKP1DtMXNoMvZ2eQrStG3-arAIFL6fH5DJ2Ftx-iDQ',
                    'https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcRsqP5keQhBgaf-pi7ErM9gYp6-qkfjoeaqo6fQwueReYo8gv6kvdGqMmVylZ62IDBoZohodDV00nx_FTJmTH-H6EwuIHsa3g4egG7bQaOUYg55aTne64jwQ4s',
                    'https://encrypted-tbn1.gstatic.com/shopping?q=tbn:ANd9GcTrlKYbh3xOJoy0MMfFGySsfs9x1UVCZeJI6BX-6oJ4I6aPg9yVs43U1Hlktd7TxuhV4gF9EfaxGsHt6S57lZTj9Ur1Kp8yug'
                ],
                sizes: [],
                colors: []
            },
            'diamond-necklace': {
                title: 'Royal Diamond Necklace',
                description: 'Exquisite handcrafted diamond necklace with 24K gold chain',
                price: 24999.99,
                images: [
                    'https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=500',
                    'https://i.pinimg.com/736x/92/f0/7b/92f07baaf6186b555578aff1eeb8b35e.jpg',
                    'https://www.mannash.in/cdn/shop/files/MCYCP675D1634_Y2.jpg?v=1698656683',
                    'https://m.media-amazon.com/images/I/61f-LNd43RL._AC_SY675_.jpg'
                ],
                sizes: [],
                colors: []
            }


        };

        let chatStarted = false;

        // Initialize chat button
        document.getElementById('chatButton').addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            toggleChat();
        });

        function toggleChat() {
            const chatInterface = document.getElementById('chat-interface');
            const resetButton = document.getElementById('resetButton');
            const chatButton = document.getElementById('chatButton');

            chatInterface.classList.toggle('open');
            chatButton.classList.toggle('open');

            // Show/hide reset button based on chat state
            if (chatInterface.classList.contains('open')) {
                resetButton.classList.add('visible');
                chatButton.title = "Close Jewellery Assistant";
            } else {
                resetButton.classList.remove('visible');
                chatButton.title = "Open Jewellery Assistant";
            }

            // Start chat on first open
            if (!chatStarted) {
                setTimeout(() => {
                    document.querySelector('#chat-interface iframe').contentWindow.postMessage('startChat', '*');
                    chatStarted = true;
                }, 500);
            }
        }

        // Initialize reset button
        document.getElementById('resetButton').addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Reset the chat by reloading the iframe
            const iframe = document.querySelector('#chat-interface iframe');
            iframe.src = iframe.src;
            chatStarted = false;

            // Start the chat again after a brief delay
            setTimeout(() => {
                document.querySelector('#chat-interface iframe').contentWindow.postMessage('startChat', '*');
                chatStarted = true;
            }, 500);
        });

        const product = products[productId];

        if (product) {
            document.title = `${product.title} - Footwear Haven`;

            // Update product details with size and color options
            document.querySelector('.product-details').innerHTML = `
                <h1 class="product-title">${product.title}</h1>
                <p class="product-description">${product.description}</p>
                <div class="product-price">‚Çπ${product.price}</div>
                <div class="size-selector">
                    <div class="size-options">
                        ${product.sizes.map(size => `
                            <button class="size-option" data-size="${size}">${size}</button>
                        `).join('')}
                    </div>
                </div>
                <div class="color-selector">
                    <div class="color-options">
                        ${product.colors.map(color => `
                            <button class="color-option" data-color="${color}">${color}</button>
                        `).join('')}
                    </div>
                </div>
                <div class="quantity-selector">
                    <label class="quantity-label">Quantity:</label>
                    <input type="number" class="quantity-input" value="1" min="1" max="10">
                </div>
                <button class="try-on-btn" onclick="tryOnJewellerys()">
                    Try On Virtually
                </button>
                <button class="add-to-cart" onclick="addToCart('${product.title}', ${product.price}, '${product.images[0]}')">
                    Add to Cart
                </button>
            `;

            const thumbnailGrid = document.querySelector('.thumbnail-list');
            thumbnailGrid.innerHTML = product.images.map((img, index) => `
                <img src="${img}" alt="${product.title} view ${index + 1}" 
                    class="thumbnail ${index === 0 ? 'active' : ''}"
                    onclick="changeMainImage(${index})">
            `).join('');

            document.getElementById('mainImage').src = product.images[0];
        }

        function changeMainImage(index) {
            const product = products[productId];
            if (product) {
                document.getElementById('mainImage').src = product.images[index];
                document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === index);
                });
            }
        }

        function addToCart(title, price, image, quantity = 1) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            // Check if item already exists in cart
            const existingItem = cart.find(item => item.title === title);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    title,
                    price,
                    image,
                    quantity
                });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.querySelector('.cart-count').textContent = totalItems;
        }

        // Initialize cart count
        updateCartCount();
        
        // Initialize product details
        document.addEventListener('DOMContentLoaded', function() {
            if (productId && products[productId]) {
                // Check if tryOn parameter is present and trigger try-on automatically
                if (tryOnParam === 'true') {
                    // Small delay to ensure everything is loaded
                    setTimeout(() => {
                        tryOnJewellerys();
                    }, 500);
                }
            }
        });
        
        // Initialize countdown timer variables
        let countdownInterval;

        // Countdown timer functionality
        function initializeCountdownTimer() {
            const countdownElement = document.getElementById('countdown-timer');
            if (!countdownElement) return;
            
            // Clear any existing interval
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            // Set end time to 10 minutes from now
            const endTime = Date.now() + (10 * 60 * 1000); // 10 minutes in milliseconds
            localStorage.setItem('dealEndTime', endTime);
            
            // Update the countdown every second
            countdownInterval = setInterval(function() {
                // Calculate remaining time
                const currentTime = Date.now();
                const remainingTime = Math.max(0, endTime - currentTime);
                
                if (remainingTime <= 0) {
                    // Timer has ended
                    clearInterval(countdownInterval);
                    countdownElement.textContent = 'Ends in 00:00';
                    return;
                }
                
                // Convert remaining time to minutes and seconds
                const minutes = Math.floor(remainingTime / (60 * 1000));
                const seconds = Math.floor((remainingTime % (60 * 1000)) / 1000);
                
                // Format the time as MM:SS
                const formattedTime = 
                    `Ends in ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update the countdown display
                countdownElement.textContent = formattedTime;
            }, 1000); // Update every second
        }
        
        // Listen for messages from chat iframe
        window.addEventListener('message', function (event) {
            if (event.data.type === 'updateQuantity') {
                document.querySelector('.quantity-input').value = event.data.quantity;
            } else if (event.data.type === 'addToCart') {
                const title = document.querySelector('.product-title').textContent;
                const price = document.querySelector('.product-price').textContent;
                const image = document.querySelector('.main-image').src;
                addToCart(title, price, image, event.data.quantity);
                if (event.data.checkout) {
                    window.location.href = 'cart.html?checkout=true';
                }
            } else if (event.data.type === 'buyNow') {
                const title = document.querySelector('.product-title').textContent;
                const price = document.querySelector('.product-price').textContent;
                const image = document.querySelector('.main-image').src;
                addToCart(title, price, image, event.data.quantity);
                window.location.href = 'cart.html?checkout=true';
            } else if (event.data.type === 'closeChat') {
                const chatInterface = document.getElementById('chat-interface');
                if (chatInterface && chatInterface.classList.contains('open')) {
                    toggleChat();
                }
            } else if (event.data.type === 'openTryoutModal') {
                console.log('Received openTryoutModal message:', event.data); // Debug log

                const modal = document.getElementById('tryOnModal');
                const tryoutInit = document.getElementById('tryoutInit');
                const tryoutMain = document.getElementById('tryoutMain');
                const chatInterface = document.getElementById('chat-interface');

                // Close chat interface if open
                if (chatInterface && chatInterface.classList.contains('open')) {
                    chatInterface.classList.remove('open');
                    document.getElementById('chatButton').classList.remove('open');
                    document.getElementById('resetButton').classList.remove('visible');
                }

                // Show modal
                modal.classList.add('active');

                // Setup main preview with AI generated image
                if (event.data.image || event.data.description) {
                    tryoutInit.style.display = 'none';
                    tryoutMain.style.display = 'flex';

                    // Set first AI image
                    const mainPreview = document.getElementById('mainPreview');
                    mainPreview.src = 'images/img1.webp';

                    // Setup preview grid
                    const previewGrid = document.querySelector('.preview-grid');
                    const previewImages = [
                        'images/img1.webp',
                        'images/img2.webp',
                        'images/img3.webp',
                        'images/img4.webp',
                        // 'images/ai_5.png'
                    ];

                    previewGrid.innerHTML = previewImages.map((img, index) => `
                        <div class="preview-thumb ${index === 0 ? 'active' : ''}" onclick="updateMainPreview('${img}', ${index})">
                            <img src="${img}" alt="View ${index + 1}">
                        </div>
                    `).join('');

                    // Show loading overlay
                    document.getElementById('loadingOverlay').classList.add('active');

                    // Animate in the main tryout view
                    setTimeout(() => {
                        tryoutMain.classList.add('active');
                        // Hide loading after 2 seconds
                        setTimeout(() => {
                            document.getElementById('loadingOverlay').classList.remove('active');
                        }, 2000);
                    }, 100);
                }
            }
        });

        function tryOnJewellerys() {
            const modal = document.getElementById('tryOnModal');
            const tryoutInit = document.getElementById('tryoutInit');

            // Reset initial states
            tryoutInit.style.display = 'block';
            tryoutInit.style.transform = 'scale(0.95) translateY(20px)';
            tryoutInit.style.opacity = '0';

            // Show modal and animate init container
            modal.classList.add('active');

            // Initialize the countdown timer when popup is first opened
            initializeCountdownTimer();

            // Trigger reflow
            void tryoutInit.offsetWidth;

            // Animate in
            tryoutInit.style.transform = 'scale(1) translateY(0)';
            tryoutInit.style.opacity = '1';

            // Setup file input handler
            const fileInput = document.getElementById('photoUpload');
            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                handleFile(file);
            });
        }

        function closeTryOnModal() {
            const modal = document.getElementById('tryOnModal');
            const tryoutInit = document.getElementById('tryoutInit');
            const tryoutMain = document.getElementById('tryoutMain');

            // If main container is visible, animate it out first
            if (tryoutMain.classList.contains('active')) {
                tryoutMain.classList.remove('active');
                setTimeout(() => {
                    tryoutMain.style.display = 'none';
                    tryoutInit.style.display = 'block';
                    tryoutInit.style.transform = 'scale(1) translateY(0)';
                    tryoutInit.style.opacity = '1';
                }, 300);
            }

            // Fade out modal
            modal.classList.remove('active');

            // Reset states
            document.getElementById('beginBtn').disabled = true;
            window.uploadedImage = null;
        }

        function handleFile(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    // Enable the begin button
                    document.getElementById('beginBtn').disabled = false;

                    // Show a preview of the uploaded image
                    const uploadContainer = document.querySelector('.upload-container');

                    // Remove existing preview if any
                    const existingPreview = uploadContainer.querySelector('.upload-preview');
                    if (existingPreview) {
                        existingPreview.remove();
                    }

                    // Create and add new preview
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'upload-preview';
                    previewDiv.style.cssText = `
                        margin: 1rem auto;
                        width: 200px;
                        height: 200px;
                        border-radius: 0.5rem;
                        overflow: hidden;
                        border: 2px solid #e2e8f0;
                    `;

                    const previewImg = document.createElement('img');
                    previewImg.src = e.target.result;
                    previewImg.style.cssText = `
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                    `;

                    previewDiv.appendChild(previewImg);
                    uploadContainer.insertBefore(previewDiv, document.getElementById('beginBtn'));

                    // Store the image data for later use
                    window.uploadedImage = e.target.result;
                };

                reader.readAsDataURL(file);
            } else {
                alert('Please upload an image file');
            }
        }

        function startTryout() {
            const tryoutInit = document.getElementById('tryoutInit');
            const tryoutMain = document.getElementById('tryoutMain');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const modal = document.getElementById('tryOnModal');
            const currentProduct = products[productId];

            // Initialize the countdown timer when main tryout view is shown
            initializeCountdownTimer();
            
            // Show loading overlay first
            loadingOverlay.classList.add('active');

            // Setup main preview with first AI image or product image based on product ID
            const mainPreview = document.querySelector('.preview-main-image');
            
            // Setup preview thumbnails based on product ID
            const previewThumbnails = document.querySelector('.preview-thumbnails');
            let previewImages;
            
            if (productId === 'indian-royal') {
                previewImages = [
                    'images/jutti1.webp',
                    'images/jutti2.webp',
                    'images/jutti3.webp',
                    'images/jutti4.webp'
                ];
                mainPreview.src = window.uploadedImage || previewImages[0];
            } else if (productId === 'diamond-necklace') {
                previewImages = [
                    'images/img1.webp',
                    'images/img2.webp',
                    'images/img3.webp',
                    'images/img4.webp',
                ];
                mainPreview.src = window.uploadedImage || previewImages[0];
            } else {
                previewImages = [
                    'images/ai_1.jpg',
                    'images/ai_2.png',
                    'images/ai_3.png',
                    'images/ai_4.png',
                    'images/ai_5.png'
                ];
                mainPreview.src = window.uploadedImage || previewImages[0];
            }

            previewThumbnails.innerHTML = previewImages.map((img, index) => `
        <div class="preview-thumb ${index === 0 ? 'active' : ''}" onclick="updateMainPreview('${img}', this)">
            <img src="${img}" alt="View ${index + 1}">
        </div>
    `).join('');

            // Add color options based on product
            const colorOptionsGrid = document.querySelector('.color-options-grid');
            let colors;
            
            if (productId === 'indian-royal') {
                colors = [
                    { name: 'Royal Gold', code: '#FFD700' },
                    { name: 'Maroon/Gold', code: '#800000' },
                    { name: 'Navy/Gold', code: '#000080' }
                ];
            } else if (productId === 'diamond-necklace') {
                colors = [
                    { name: 'Silver', code: '#C0C0C0' },
                    { name: 'Gold', code: '#FFD700' },
                    { name: 'Rose Gold', code: '#B76E79' },
                    { name: 'Platinum', code: '#E5E4E2' }
                ];
            } else {
                colors = [
                    { name: 'orig', code: '#00E5FF' },
                    { name: 'Black/Red', code: '#fc5757' },
                    { name: 'Blue/White', code: '#7474fc' },
                    { name: 'Grey/Neon', code: '#0ff20e' },
                    { name: 'Brown', code: '#f48413' }
                ];
            }

            colorOptionsGrid.innerHTML = colors.map((color, index) => `
                <button class="color-option-btn ${index === 0 ? 'active' : ''}"
                        onclick="updateJewelleryColor('${color.name}', this)"
                        style="background-color: ${color.code};">
                </button>
            `).join('');

            // Animate transition
            tryoutInit.style.opacity = '0';
            tryoutInit.style.transform = 'scale(0.95)';

            setTimeout(() => {
                tryoutInit.style.display = 'none';
                tryoutMain.style.display = 'flex';

                // Force reflow
                void tryoutMain.offsetWidth;

                // Add active class for animation
                tryoutMain.classList.add('active');

                // Hide loading overlay after animation
                setTimeout(() => {
                    loadingOverlay.classList.remove('active');
                }, 1000);
            }, 300);
        }

        // Update the updateMainPreview function to handle the thumb element
        function updateMainPreview(imgSrc, thumbElement) {
            // Update main preview image
            const mainPreview = document.querySelector('.preview-main-image');
            mainPreview.src = imgSrc;

            // Update active state of thumbnails
            document.querySelectorAll('.preview-thumb').forEach(thumb => {
                thumb.classList.remove('active');
            });

            // Add active class to clicked thumbnail
            if (thumbElement) {
                if (typeof thumbElement === 'number') {
                    document.querySelectorAll('.preview-thumb')[thumbElement]?.classList.add('active');
                } else {
                    thumbElement.classList.add('active');
                }
            }
            
            // Reapply color overlay with new dimensions if a color is selected
            const activeColorBtn = document.querySelector('.color-option-btn.active');
            if (activeColorBtn) {
                // Get the color name from the button's onclick attribute
                const onclickAttr = activeColorBtn.getAttribute('onclick');
                const colorMatch = onclickAttr.match(/updateJewelleryColor\('([^']+)'/);
                if (colorMatch && colorMatch[1]) {
                    // Reapply the color with the new image dimensions
                    updateJewelleryColor(colorMatch[1], activeColorBtn);
                }
            }
        }

        function updateSimilarColor(productId, color) {
            // Get the current preview image
            const mainPreview = document.getElementById('mainPreview');
            const currentImage = mainPreview.src;

            // Add color overlay effect (example)
            mainPreview.style.filter = `hue-rotate(${getHueRotation(color)}deg)`;

            // Store selected color
            window.selectedColor = color;
        }

        function getHueRotation(color) {
            // Simple mapping of colors to hue rotation values
            const hueMap = {
                'Blue/White': 240,
                'Black/Red': 0,
                'Grey/Neon': 120,
                'Brown': 30,
                'Navy': 240,
                'Black/Yellow': 60,
                'Blue/Orange': 200,
                'White/Red': 0,
                // Indian Royal shoe colors
                'Royal Gold': 45,  // Gold hue
                'Maroon/Gold': 0,  // Maroon is reddish
                'Navy/Gold': 240,  // Navy blue hue
                'Silver': 0,       // Silver (neutral)
                'Gold': 45,        // Gold hue
                'Rose Gold': 330,   // Rose gold (pinkish)
                'Platinum': 0      // Platinum (neutral)
            };
            return hueMap[color] || 0;
        }

        function getColorCode(color) {
            const colorMap = {
                'Black/Red': '#000000',
                'Blue/White': '#0066cc',
                'Grey/Neon': '#808080',
                'Brown': '#8B4513',
                'Black': '#000000',
                'Navy': '#00E5FF',
                'Black/Yellow': '#000000',
                'Blue/Orange': '#0066cc',
                'White/Red': '#FFFFFF',
                // Add colors for Indian Royal jewellery
                'Royal Gold': '#FFD700',
                'Maroon/Gold': '#800000',
                'Navy/Gold': '#000080',
                'Silver': '#C0C0C0',
                'Gold': '#FFD700',
                'Rose Gold': '#B76E79',
                'Platinum': '#E5E4E2'
            };
            return colorMap[color] || '#000000';
        }

        function selectSize(element, size) {
            // Remove active class from all size options
            document.querySelectorAll('.size-grid-option').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to selected size
            element.classList.add('active');

            // Store selected size
            window.selectedSize = size;
        }

        // Configuration object for overlay dimensions for each image
        const overlayConfig = {
            'images/ai_1.jpg': { width: '35%', height: '42%', left: '35%', right: '40%', bottom: '0' },
            'images/ai_2.png': [
                { id: 'primary', width: '45%', height: '35%', left: '15%', bottom: '0', borderRadius: '10 10 50% 50%',transform: 'rotate(90deg)' },
                { id: 'secondary', width: '20%', height: '31%', left: '63%', bottom: '20%' }
            ],
            'images/ai_3.png': { width: '45%', height: '50%', left: '25%', bottom: '0' },
            'images/ai_4.png': { width: '65%', height: '35%', left: '20%', bottom: '0' },
            'images/ai_5.png': [
                { id: 'primary', width: '50%', height: '30%', left: '15%', bottom: '5%' },
                { id: 'secondary', width: '40%', height: '40%', left: '60%', bottom: '10%' }
            ],
            'images/jutti1.webp': { width: '40%', height: '30%', left: '30%', bottom: '10%' },
            'images/jutti2.webp': { width: '45%', height: '35%', left: '25%', bottom: '5%' },
            'images/jutti3.webp': { width: '50%', height: '40%', left: '20%', bottom: '0' },
            'images/jutti4.webp': { width: '45%', height: '35%', left: '25%', bottom: '5%' },
            'default': { width: '60%', height: '45%', left: '40%', bottom: '0' }
        };

        function updateJewelleryColor(color, element) {
            // Remove active class from all color options
            document.querySelectorAll('.color-option-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Add active class to selected color
            if (element) {
                element.classList.add('active');
            }

            // Get the current preview image
            const mainPreview = document.querySelector('.preview-main-image');
            const currentImage = mainPreview.src;
            const imageName = currentImage.split('/').pop();

            // Remove existing overlays
            document.querySelectorAll('.color-overlay').forEach(overlay => overlay.remove());

            // Get overlay config for current image
            const config = overlayConfig[imageName] || overlayConfig['default'];

            // Create and apply overlays
            if (Array.isArray(config)) {
                config.forEach(cfg => createOverlay(cfg, color));
            } else {
                createOverlay(config, color);
            }

            // Store selected color
            window.selectedColor = color;
        }
        
        function createOverlay(dimensions, color, container, index = 0) {
            const overlay = document.createElement('div');
            overlay.id = `colorOverlay${index}`;
            overlay.style.position = 'absolute';
            overlay.style.bottom = dimensions.bottom;
            overlay.style.left = dimensions.left;
            overlay.style.width = dimensions.width;
            overlay.style.height = dimensions.height;
            overlay.style.pointerEvents = 'none';
            overlay.style.mixBlendMode = 'hue';
            overlay.style.backgroundColor = getColorForHueRotation(getHueRotation(color));
            overlay.style.zIndex = '1';
            
            // Add controls for the second and last image overlays
            if ((container.querySelector('img').src.includes('ai_2.png') || 
                 container.querySelector('img').src.includes('ai_5.png')) && 
                dimensions.id) {
                
                // Make the overlay draggable and resizable
                overlay.style.cursor = 'move';
                overlay.style.border = '1px dashed rgba(255,255,255,0.5)';
                overlay.style.pointerEvents = 'auto';
                
                // Add a small label to identify the overlay
                const label = document.createElement('div');
                label.textContent = dimensions.id;
                label.style.position = 'absolute';
                label.style.top = '0';
                label.style.left = '0';
                label.style.fontSize = '10px';
                label.style.background = 'rgba(0,0,0,0.5)';
                label.style.color = 'white';
                label.style.padding = '2px 5px';
                overlay.appendChild(label);
                
                // Make overlay draggable
                overlay.addEventListener('mousedown', startDrag);
                
                // Add resize handle
                const resizeHandle = document.createElement('div');
                resizeHandle.style.position = 'absolute';
                resizeHandle.style.width = '10px';
                resizeHandle.style.height = '10px';
                resizeHandle.style.right = '0';
                resizeHandle.style.bottom = '0';
                resizeHandle.style.background = 'white';
                resizeHandle.style.cursor = 'nwse-resize';
                resizeHandle.addEventListener('mousedown', startResize);
                overlay.appendChild(resizeHandle);
            }
            
            // Add the overlay to the container
            container.appendChild(overlay);
        }
        
        // Dragging functionality
        function startDrag(e) {
            const overlay = e.currentTarget;
            const startX = e.clientX;
            const startY = e.clientY;
            const startLeft = parseInt(overlay.style.left);
            const startBottom = parseInt(overlay.style.bottom);
            
            function drag(e) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                overlay.style.left = `${startLeft + dx}px`;
                overlay.style.bottom = `${startBottom - dy}px`;
            }
            
            function stopDrag() {
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
            }
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            e.preventDefault();
        }
        
        // Resizing functionality
        function startResize(e) {
            const overlay = e.currentTarget.parentElement;
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = parseInt(overlay.style.width);
            const startHeight = parseInt(overlay.style.height);
            
            function resize(e) {
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                overlay.style.width = `${startWidth + dx}px`;
                overlay.style.height = `${startHeight + dy}px`;
            }
            
            function stopResize() {
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);
            }
            
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);
            e.preventDefault();
            e.stopPropagation(); // Prevent triggering the parent's drag event
        }
        
        // Helper function to convert hue rotation to an actual color
        function getColorForHueRotation(hue) {
            // Convert hue rotation to HSL color
            return `hsl(${hue}, 100%, 50%)`;
        }
    </script>
</body>

</html>